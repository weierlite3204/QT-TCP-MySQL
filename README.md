# 传感器数据监控系统

## 项目简介

这是一个基于Qt开发的传感器数据监控系统，用于实时监测、显示和存储环境参数数据，包括空气温度、湿度、氧气浓度、土壤温度、湿度和光照强度等环境参数。系统支持数据可视化展示、数据库存储、调试功能和Excel数据导出（包含表格和图表）。

## 功能特性

### 1. 数据监测与显示
- 实时监测并显示多种环境参数：空气温度、湿度、氧气浓度、土壤温度、湿度、光照强度
- 通过折线图直观展示数据变化趋势
- 支持图表动态更新，最大绘制点数可配置（默认300点）

### 2. 数据库功能
- 连接MySQL数据库存储监测数据
- 提供数据库查询接口
- 支持数据持久化存储

### 3. 远程控制功能
- 支持远程控制灯光开关
- 支持远程控制浇水系统
- 通过TCP通信实现远程命令下发

### 4. 调试功能
- 提供独立的调试界面
- 显示通信日志和调试信息
- 支持手动发送命令测试

### 5. 数据导出功能
- 支持将监测数据导出为Excel文件
- 导出文件包含两个工作表：空气参数和土壤参数
- 每个工作表都包含数据表格和对应的折线图表

## 系统架构

### 核心组件
- **主界面（Widget）**：系统的主要交互界面，显示实时数据和图表
- **TCP服务器（MyTcpServer）**：处理网络通信，接收客户端连接和数据
- **消息处理器（MsgWorker）**：处理接收到的消息
- **数据库工作器（DatabaseWorker）**：处理数据库操作
- **调试界面（Debugging）**：提供调试功能
- **数据库界面（Mysql）**：提供数据库连接和操作界面

### 数据流
1. 传感器数据通过TCP连接传输到系统
2. 系统解析数据并更新界面显示
3. 数据同时存储到数据库中
4. 用户可以导出数据为Excel文件进行分析

## 技术栈

- **开发框架**：Qt 6.x
- **图表库**：QCustomPlot
- **Excel操作**：QXlsx库
- **数据库**：MySQL
- **通信协议**：TCP/IP
- **开发环境**：Qt Creator

## 安装说明

### 前提条件
- Qt 6.x开发环境
- MySQL数据库服务器
- Windows操作系统

### 安装步骤
1. 克隆或下载项目代码
2. 使用Qt Creator打开项目文件 `SerialAndTCP.pro`
3. 配置项目构建参数
4. 构建并运行项目

## 使用指南

### 启动系统
1. 运行编译后的可执行文件
2. 系统启动后，将显示主界面

### 连接设置
1. 在主界面顶部设置IP地址和端口号
2. 点击连接按钮建立与数据源的连接

### 数据显示
- 系统将实时更新传感器数据
- 图表区域将显示数据变化趋势

### 远程控制
- 点击"开灯"按钮控制灯光
- 点击"浇水"按钮控制浇水系统

### 数据库操作
- 点击"数据库"按钮打开数据库界面
- 在数据库界面中配置连接参数并操作数据库

### 调试功能
- 点击"调试"按钮打开调试界面
- 查看通信日志和发送调试命令

### 数据导出
- 点击"导出(xlsx)"按钮
- 选择保存路径
- 导出的Excel文件将包含数据表格和图表
- 图表位于数据表格下方，请向下滚动查看

## 配置说明

### 图表配置
- 图表最大绘制点数可在 `widget.h` 文件中修改 `maxDataPoints` 常量
- 默认值为300点

### 数据库配置
- 在数据库界面中设置数据库连接参数
- 包括主机地址、用户名、密码和数据库名称

## 故障排除

### 连接问题
- 检查IP地址和端口号是否正确
- 确保网络连接正常
- 确认数据源设备正在运行

### 数据显示问题
- 检查传感器是否正常工作
- 验证数据格式是否正确

### 数据库连接问题
- 确认MySQL服务正在运行
- 检查连接参数是否正确
- 验证用户权限

## 项目结构

```
SerialAndTCP/
├── databaseworker.cpp  // 数据库工作器实现
├── databaseworker.h    // 数据库工作器头文件
├── debugging.cpp       // 调试界面实现
├── debugging.h         // 调试界面头文件
├── debugging.ui        // 调试界面UI设计
├── main.cpp            // 程序入口
├── msgworker.cpp       // 消息处理器实现
├── msgworker.h         // 消息处理器头文件
├── mysql.cpp           // 数据库界面实现
├── mysql.h             // 数据库界面头文件
├── mysql.ui            // 数据库界面UI设计
├── mytcpserver.cpp     // TCP服务器实现
├── mytcpserver.h       // TCP服务器头文件
├── qcustomplot.cpp     // 图表库实现
├── qcustomplot.h       // 图表库头文件
├── sensordata.h        // 传感器数据结构定义
├── SerialAndTCP.pro    // 项目配置文件
├── widget.cpp          // 主界面实现
├── widget.h            // 主界面头文件
├── widget.ui           // 主界面UI设计
└── README.md           // 项目说明文档
```

## 许可证

本项目仅供学习和参考使用。

## 联系方式

如有问题或建议，请联系项目开发团队。